<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Droit Décodé - Connexion / Inscription</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-red: #E84D3D;
            --primary-blue: #3498DB;
            --text-dark: #2c3e50;
            --background-light: #F4F4F4;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-light);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        /* Ensure button is always visible */
        .btn-submit {
            background-color: #E84D3D !important;
            color: white !important;
            display: block !important;
            width: 100%;
        }
    </style>
</head>
<body>

    <div class="p-4 w-full max-w-sm mx-auto">
        <div class="text-center mb-8">
            <img src="logo1.jpeg" alt="Logo" class="mx-auto h-16 w-auto rounded-xl shadow-lg border-2 border-primary-blue" onerror="this.onerror=null;this.src='https://placehold.co/64x64/3498DB/FFFFFF?text=DD'">
            <h1 class="mt-4 text-3xl font-extrabold text-text-dark">Droit Décodé</h1>
            <p class="text-sm text-gray-500 mt-1" id="mode-subtitle">Connectez-vous pour continuer.</p>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-2xl border-t-8 border-primary-red">
            <form id="auth-form" class="space-y-6">
                <div id="name-field" class="hidden">
                    <label class="block text-sm font-medium text-gray-700">Nom / Prénom</label>
                    <input type="text" id="name" placeholder="Ex: Jean Dupont" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-red focus:border-primary-red outline-none">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Adresse Email</label>
                    <input type="email" id="email" required placeholder="utilisateur@exemple.com" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-red focus:border-primary-red outline-none">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Mot de Passe</label>
                    <input type="password" id="password" required placeholder="Min. 6 caractères" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-red focus:border-primary-red outline-none">
                </div>

                <button type="submit" id="auth-button" class="btn-submit py-3 px-4 rounded-md font-bold transition duration-200 hover:opacity-90">
                    Se connecter
                </button>
            </form>

            <div class="mt-6 text-center">
                <p class="text-sm text-gray-600">
                    <span id="toggle-text">Pas encore de compte?</span>
                    <button type="button" id="toggle-mode" class="font-bold text-primary-blue ml-1">S'inscrire</button>
                </p>
            </div>
        </div>
    </div>

    <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center p-4 z-50">
        <div id="modal-card" class="bg-white rounded-lg p-6 shadow-2xl w-full max-w-sm border-t-8 transition-all">
            <h3 id="modal-title" class="text-xl font-bold mb-2">Message</h3>
            <p id="modal-content" class="text-gray-700 mb-6"></p>
            <div class="flex justify-end">
                <button id="modal-close-btn" class="py-2 px-6 bg-gray-800 text-white font-bold rounded-md">OK</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDpNtHXiZK3bIyLwAUlTNAiWRrg2vhPYeE",
            authDomain: "droitdecode-9aa4d.firebaseapp.com",
            projectId: "droitdecode-9aa4d",
            storageBucket: "droitdecode-9aa4d.firebasestorage.app",
            messagingSenderId: "219930978240",
            appId: "1:219930978240:web:886c40e47d276c75548a25"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const authForm = document.getElementById('auth-form');
        const authButton = document.getElementById('auth-button');
        const toggleModeBtn = document.getElementById('toggle-mode');
        const nameFieldDiv = document.getElementById('name-field');
        const nameInput = document.getElementById('name');

        let isLoginMode = true;

        toggleModeBtn.addEventListener('click', () => {
            isLoginMode = !isLoginMode;
            authButton.textContent = isLoginMode ? "Se connecter" : "Créer mon compte";
            nameFieldDiv.classList.toggle('hidden', isLoginMode);
            nameInput.required = !isLoginMode;
            document.getElementById('toggle-text').textContent = isLoginMode ? "Pas encore de compte?" : "Déjà un compte?";
            toggleModeBtn.textContent = isLoginMode ? "S'inscrire" : "Se connecter";
        });

        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            authButton.disabled = true;
            authButton.textContent = "Chargement...";

            try {
                let user;
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                if (isLoginMode) {
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    user = userCredential.user;
                    alertMsg("Connexion réussie ! Redirection...", "success");
                } else {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    user = userCredential.user;
                    await updateProfile(user, { displayName: nameInput.value });
                    await setDoc(doc(db, 'UserProfiles', user.uid), {
                        name: nameInput.value,
                        email: email,
                        createdAt: new Date().toISOString()
                    });
                    alertMsg("Compte créé avec succès !", "success");
                }

                // --- REDIRECTION LOGIC ---
                setTimeout(() => {
                    const ADMIN_UID = "v4086Cxmi9PMI31GUBZzY8rHyIA3";
                    
                    // If you are the admin, go to admin.html, otherwise go to index.html
                    if (user.uid === ADMIN_UID) {
                        window.location.replace('admin.html');
                    } else {
                        window.location.replace('index.html');
                    }
                }, 1500);

            } catch (error) {
                console.error(error);
                let errorMsgTxt = "Erreur : Vérifiez vos informations.";
                if (error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                    errorMsgTxt = "Email ou mot de passe incorrect.";
                }
                alertMsg(errorMsgTxt, "error");
                authButton.disabled = false;
                authButton.textContent = isLoginMode ? "Se connecter" : "Créer mon compte";
            }
        });

        function alertMsg(msg, type) {
            document.getElementById('modal-content').textContent = msg;
            const card = document.getElementById('modal-card');
            card.style.borderColor = (type === "success") ? "#27ae60" : "#E84D3D";
            document.getElementById('modal-title').textContent = (type === "success") ? "Succès" : "Attention";
            document.getElementById('message-modal').classList.remove('hidden');
        }

        document.getElementById('modal-close-btn').addEventListener('click', () => {
            document.getElementById('message-modal').classList.add('hidden');
        });
    </script>
</body>
</html>
