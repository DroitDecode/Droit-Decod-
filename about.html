<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Droit DÃ©codÃ© - Ã€ Propos</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

    <style>
        :root {
            --color-primary-red: #E84D3D;
            --color-primary-blue: #3E4B7A;
            --color-secondary-bg: #F8F9FA;
        }
        body { 
            background-color: var(--color-secondary-bg); 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            font-family: 'Inter', sans-serif; 
        }
        main { flex-grow: 1; }
        .text-primary-red { color: var(--color-primary-red); }
        .text-primary-blue { color: var(--color-primary-blue); }
        .bg-primary-red { background-color: var(--color-primary-red); }
        
        /* Editable highlight */
        .editable-content:focus { 
            outline: 2px solid var(--color-primary-red); 
            background-color: #fff9f9; 
            padding: 4px;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 h-16 flex justify-between items-center">
            <a href="index.html" class="flex items-center space-x-2 flex-shrink-0">
                <img src="logo1.jpeg" alt="Logo" class="h-10 w-10 rounded-full border border-gray-100">
                <div class="text-xl font-black">
                    <span class="text-primary-blue">DROIT</span> <span class="text-primary-red">DÃ‰CODÃ‰</span>
                </div>
            </a>

            <nav class="hidden md:flex flex-grow justify-center items-center space-x-8 font-bold text-gray-600">
                <a href="index.html" class="hover:text-primary-red transition">Accueil</a>
                <a href="articles.html" class="hover:text-primary-red transition">Articles</a>
                <a href="about.html" class="text-primary-red">Ã€ Propos</a>
                <a href="contact.html" class="hover:text-primary-red transition">Contact</a>
                <div id="admin-zone-desktop" class="hidden"></div>
            </nav>

            <div class="hidden md:flex items-center space-x-4">
                <span id="user-greeting" class="text-sm font-medium text-gray-500"></span>
                <a id="auth-btn" href="login.html" class="bg-primary-red text-white px-4 py-2 rounded-lg font-bold text-sm shadow-md hover:opacity-90 transition">
                    Se connecter
                </a>
            </div>

            <button id="menu-btn" class="md:hidden text-primary-blue text-3xl focus:outline-none">
                &#9776;
            </button>
        </div>

        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100 p-6 flex flex-col items-center space-y-5 font-bold text-gray-700 shadow-xl">
            <span id="user-greeting-mobile" class="text-primary-blue text-sm"></span>
            <a href="index.html" class="hover:text-primary-red">Accueil</a>
            <a href="articles.html" class="hover:text-primary-red">Articles</a>
            <a href="about.html" class="text-primary-red">Ã€ Propos</a>
            <a href="contact.html" class="hover:text-primary-red">Contact</a>
            <div id="admin-zone-mobile" class="hidden"></div>
            <a id="auth-btn-mobile" href="login.html" class="bg-primary-red text-white px-8 py-2 rounded-lg w-full text-center">
                Se connecter
            </a>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-10">
        <h1 id="main-title" class="text-3xl md:text-5xl font-black text-center text-primary-blue border-b-4 border-primary-red pb-4 mb-8 editable-content">
            Chargement...
        </h1>

        <section class="bg-white p-6 md:p-10 rounded-2xl shadow-xl mb-10">
            <h2 class="text-2xl font-bold text-primary-red mb-4 uppercase tracking-widest text-center md:text-left">Notre Mission</h2>
            <div id="mission-text" class="text-lg md:text-xl leading-relaxed text-gray-700 italic border-l-4 border-primary-blue pl-4 md:pl-6 mb-10 editable-content">
                Chargement...
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center mb-10">
                <div class="p-4 bg-primary-red text-white rounded-xl shadow-md font-bold">ðŸŽ“ Ã‰tudiants</div>
                <div class="p-4 bg-primary-blue text-white rounded-xl shadow-md font-bold">ðŸ’¼ Professionnels</div>
                <div class="p-4 bg-primary-red text-white rounded-xl shadow-md font-bold">ðŸ’¡ Citoyens</div>
            </div>

            <div class="p-6 md:p-8 bg-primary-blue text-white rounded-2xl shadow-2xl">
                <h3 class="text-xl md:text-2xl font-bold mb-4 text-center md:text-left">Notre Engagement</h3>
                <div id="engagement-text" class="text-base md:text-lg opacity-90 leading-relaxed editable-content">
                    Chargement...
                </div>
            </div>
        </section>
    </main>

    <footer class="p-8 text-center text-gray-400 text-sm border-t bg-white mt-auto">
        <p>&copy; 2025 Droit DÃ©codÃ©. Tous droits rÃ©servÃ©s.</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDpNtHXiZK3bIyLwAUlTNAiWRrg2vhPYeE",
            authDomain: "droitdecode-9aa4d.firebaseapp.com",
            projectId: "droitdecode-9aa4d",
            storageBucket: "droitdecode-9aa4d.firebasestorage.app",
            messagingSenderId: "219930978240",
            appId: "1:219930978240:web:886c40e47d276c75548a25"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const ADMIN_UID = "v4086Cxmi9PMI31GUBZzY8rHyIA3";
        const DOC_REF = doc(db, "Pages", "About");

        const menuBtn = document.getElementById('menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const userGreeting = document.getElementById('user-greeting');
        const userGreetingMob = document.getElementById('user-greeting-mobile');
        const authBtn = document.getElementById('auth-btn');
        const authBtnMob = document.getElementById('auth-btn-mobile');
        
        const fields = {
            title: document.getElementById('main-title'),
            mission: document.getElementById('mission-text'),
            engagement: document.getElementById('engagement-text')
        };
        const adminZoneDesktop = document.getElementById('admin-zone-desktop');
        const adminZoneMobile = document.getElementById('admin-zone-mobile');

        let isEditing = false;

        // --- MENU MOBILE ---
        menuBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

        // --- REAL-TIME DATA ---
        onSnapshot(DOC_REF, (snap) => {
            if (snap.exists() && !isEditing) {
                const data = snap.data();
                fields.title.innerText = data.title || "Droit DÃ©codÃ©";
                fields.mission.innerText = data.mission || "Mission...";
                fields.engagement.innerText = data.engagement || "Engagement...";
            }
        });

        // --- AUTHENTICATION & USER GREETING ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                const name = user.displayName || user.email.split('@')[0];
                userGreeting.innerText = `Bonjour, ${name}`;
                userGreetingMob.innerText = `Bonjour, ${name}`;
                authBtn.innerText = "DÃ©connexion";
                authBtnMob.innerText = "DÃ©connexion";
                
                authBtn.onclick = authBtnMob.onclick = (e) => {
                    e.preventDefault();
                    signOut(auth).then(() => window.location.reload());
                };

                // Admin check
                if (user.uid === ADMIN_UID) {
                    adminZoneDesktop.classList.remove('hidden');
                    adminZoneMobile.classList.remove('hidden');
                    renderAdminBtn();
                }
            } else {
                userGreeting.innerText = "";
                userGreetingMob.innerText = "";
                authBtn.innerText = "Se connecter";
                authBtnMob.innerText = "Se connecter";
                authBtn.href = authBtnMob.href = "login.html";
            }
        });

        function renderAdminBtn() {
            [adminZoneDesktop, adminZoneMobile].forEach(zone => {
                zone.innerHTML = '';
                const btn = document.createElement('button');
                btn.className = isEditing ? "bg-green-500 text-white px-3 py-1 rounded font-bold" : "border border-blue-800 text-blue-800 px-3 py-1 rounded font-bold";
                btn.innerText = isEditing ? "SAUVEGARDER" : "MODIFIER TEXTES";
                btn.onclick = isEditing ? saveChanges : startEditing;
                zone.appendChild(btn);
            });
        }

        function startEditing() {
            isEditing = true;
            Object.values(fields).forEach(el => el.contentEditable = true);
            renderAdminBtn();
        }

        async function saveChanges() {
            try {
                await setDoc(DOC_REF, {
                    title: fields.title.innerText,
                    mission: fields.mission.innerText,
                    engagement: fields.engagement.innerText
                }, { merge: true });
                isEditing = false;
                Object.values(fields).forEach(el => el.contentEditable = false);
                renderAdminBtn();
                alert("ModifiÃ© !");
            } catch (e) { alert("Erreur: " + e.message); }
        }
    </script>
</body>
</html>
