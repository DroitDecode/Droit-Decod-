<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Droit DÃ©codÃ© - Ã€ Propos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --color-primary-red: #E84D3D; --color-primary-blue: #3E4B7A; --color-secondary-bg: #F8F9FA; }
        body { background-color: var(--color-secondary-bg); min-height: 100vh; display: flex; flex-direction: column; font-family: 'Inter', sans-serif; }
        main { flex-grow: 1; max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .text-primary-red { color: var(--color-primary-red); }
        .text-primary-blue { color: var(--color-primary-blue); }
        .bg-primary-red { background-color: var(--color-primary-red); }
        .editable-content:focus { outline: 2px solid var(--color-primary-red); background-color: #fff9f9; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; background-color: white; shadow: 0 2px 4px rgba(0,0,0,0.05); }
        nav ul { display: flex; list-style: none; gap: 1.5rem; align-items: center; }
        .contact-btn { background-color: var(--color-primary-red); color: white !important; padding: 0.5rem 1rem; border-radius: 0.5rem; }
    </style>
</head>
<body>

    <header role="banner">
        <div class="logo-container flex items-center">
            <a href="index.html" class="flex items-center">
                <img src="logo1.jpeg" alt="Logo" class="h-10 w-10 rounded-full mr-2">
                <div class="text-xl font-bold"><span class="text-primary-blue">DROIT</span> <span class="text-primary-red">DÃ‰CODÃ‰</span></div>
            </a>
        </div>
        <nav>
            <ul>
                <li><a href="index.html">Accueil</a></li>
                <li><a href="articles.html">Articles</a></li>
                <li id="admin-zone" class="hidden"></li> <li><a href="about.html" class="text-primary-red font-bold">Ã€ Propos</a></li>
                <li><a href="contact.html" class="contact-btn">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h1 id="main-title" class="text-4xl md:text-5xl font-extrabold mb-10 text-center text-primary-blue border-b-4 pb-3 border-primary-red editable-content">
            Chargement...
        </h1>

        <section class="bg-white p-8 rounded-xl shadow-2xl mb-12">
            <h2 class="text-3xl font-bold mb-6 text-primary-red">Notre Mission Fondatrice</h2>
            <p id="mission-text" class="text-xl mb-8 leading-relaxed border-l-4 border-primary-blue pl-4 italic text-gray-700 editable-content">
                Chargement...
            </p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center mb-10">
                <div class="p-4 bg-primary-red text-white rounded-lg">ðŸŽ“ Ã‰tudiants</div>
                <div class="p-4 bg-primary-blue text-white rounded-lg">ðŸ’¼ Professionnels</div>
                <div class="p-4 bg-primary-red text-white rounded-lg">ðŸ’¡ Citoyens</div>
            </div>

            <div class="mt-12 p-6 bg-primary-blue text-white rounded-xl shadow-2xl">
                <h3 class="text-2xl font-bold mb-3">Notre Engagement de Rigueur</h3>
                <p id="engagement-text" class="text-lg editable-content">
                    Chargement...
                </p>
            </div>
        </section>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDpNtHXiZK3bIyLwAUlTNAiWRrg2vhPYeE",
            authDomain: "droitdecode-9aa4d.firebaseapp.com",
            projectId: "droitdecode-9aa4d",
            storageBucket: "droitdecode-9aa4d.firebasestorage.app",
            messagingSenderId: "219930978240",
            appId: "1:219930978240:web:886c40e47d276c75548a25"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const ADMIN_UID = "v4086Cxmi9PMI31GUBZzY8rHyIA3";
        const DOC_REF = doc(db, "Pages", "About");

        const fields = {
            title: document.getElementById('main-title'),
            mission: document.getElementById('mission-text'),
            engagement: document.getElementById('engagement-text')
        };
        const adminZone = document.getElementById('admin-zone');
        let isEditing = false;

        // 1. Ã‰COUTE DES DONNÃ‰ES (DYNAMIQUE)
        onSnapshot(DOC_REF, (snap) => {
            if (snap.exists() && !isEditing) {
                const data = snap.data();
                fields.title.innerText = data.title || "Titre Ã  dÃ©finir";
                fields.mission.innerText = data.mission || "Mission Ã  dÃ©finir";
                fields.engagement.innerText = data.engagement || "Engagement Ã  dÃ©finir";
            }
        });

        // 2. VÃ‰RIFICATION ADMIN POUR AFFICHER LE BOUTON
        onAuthStateChanged(auth, (user) => {
            if (user && user.uid === ADMIN_UID) {
                adminZone.classList.remove('hidden');
                renderAdminBtn();
            }
        });

        function renderAdminBtn() {
            adminZone.innerHTML = '';
            const btn = document.createElement('button');
            btn.className = "px-3 py-1 rounded text-sm font-bold " + (isEditing ? "bg-green-500 text-white" : "border border-blue-800 text-blue-800");
            btn.innerText = isEditing ? "ENREGISTRER" : "MODIFIER TEXTES";
            btn.onclick = isEditing ? saveChanges : startEditing;
            adminZone.appendChild(btn);
        }

        function startEditing() {
            isEditing = true;
            Object.values(fields).forEach(el => el.contentEditable = true);
            renderAdminBtn();
        }

        async function saveChanges() {
            try {
                await setDoc(DOC_REF, {
                    title: fields.title.innerText,
                    mission: fields.mission.innerText,
                    engagement: fields.engagement.innerText
                }, { merge: true });
                isEditing = false;
                Object.values(fields).forEach(el => el.contentEditable = false);
                renderAdminBtn();
                alert("Mise Ã  jour rÃ©ussie !");
            } catch (e) { alert("Erreur : " + e.message); }
        }
    </script>
</body>
</html>
