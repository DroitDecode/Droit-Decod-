<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Droit D√©cod√© - √Ä Propos</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#E84D3D"> 
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom CSS for colors and layout adjustments -->
    <style>
        /* Define color variables for consistency across pages */
        :root {
            --color-primary-red: #E84D3D;
            --color-primary-blue: #3E4B7A; /* Deep, professional blue */
            --color-secondary-bg: #F8F9FA; /* Subtle light gray for background */
        }

        /* 1. Page background and font */
        body {
            background-color: var(--color-secondary-bg); 
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: 'Inter', sans-serif;
        }

        /* Ensure main content takes remaining space */
        main {
            flex-grow: 1; 
            max-width: 1200px;
            margin: 2rem auto; /* Vertical spacing */
            padding-left: 1rem;
            padding-right: 1rem;
        }

        /* Custom Tailwind Color Classes */
        .text-primary-red { color: var(--color-primary-red); }
        .bg-primary-red { background-color: var(--color-primary-red); }
        .text-primary-blue { color: var(--color-primary-blue); }
        .bg-primary-blue { background-color: var(--color-primary-blue); }
        .border-primary-red { border-color: var(--color-primary-red); }
        .border-primary-blue { border-color: var(--color-primary-blue); }

        /* Header & Nav Styles */
        .logo-text strong { color: var(--color-primary-blue); font-weight: 700; }
        .logo-text span { color: var(--color-primary-red); font-weight: 700; }
        .logo-container a { display: flex; align-items: center; text-decoration: none; }
        .logo-container img { height: 40px; width: 40px; border-radius: 50%; margin-right: 10px; }
        .logo-text { font-size: 1.5rem; line-height: 1; font-weight: 300; }
        
        header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; background-color: white; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); }
        header nav ul { display: flex; list-style: none; gap: 1.5rem; margin: 0; padding: 0; align-items: center; }
        header nav ul li a { color: #4B5563; text-decoration: none; padding: 0.5rem 0; transition: color 0.3s; }
        header nav ul li a:hover { color: var(--color-primary-red); }

        /* Nav Buttons */
        .contact-btn, .log-btn { padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; }
        .contact-btn { background-color: var(--color-primary-red); color: white !important; }
        .log-btn { border: 1px solid var(--color-primary-blue); color: var(--color-primary-blue) !important; }
        .admin-action-btn { 
            padding: 0.5rem 1rem; 
            border-radius: 0.5rem; 
            font-weight: 600; 
            transition: background-color 0.3s;
            cursor: pointer;
            border: none;
        }
        .edit-mode-btn { background-color: var(--color-primary-blue); color: white !important; }
        .edit-mode-btn:hover { background-color: #313c63; }
        .save-btn { background-color: #10B981; color: white !important; } /* Emerald Green */
        .save-btn:hover { background-color: #059669; }
        .cancel-btn { background-color: #FBBF24; color: #1F2937 !important; } /* Amber Yellow */
        .cancel-btn:hover { background-color: #F59E0B; }

        /* Active Link Styling */
        header nav ul li a.active {
            color: var(--color-primary-red);
            font-weight: 700;
            border-bottom: 2px solid var(--color-primary-red);
        }

        /* Styling for editable content */
        .editable-content:focus {
            outline: 2px solid var(--color-primary-red);
            outline-offset: 4px;
            background-color: #fff9f9;
        }
        .editable-content[contenteditable="true"] {
            cursor: text;
        }

        /* Responsive menu */
        .menu-toggle { display: none; }
        @media (max-width: 640px) {
            header nav ul { display: none; flex-direction: column; position: absolute; top: 60px; right: 0; width: 100%; background-color: white; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); padding: 1rem 0; z-index: 50; align-items: stretch; }
            header nav ul.open { display: flex; }
            header nav ul li { width: 100%; text-align: center; padding: 0.5rem 0; border-bottom: 1px solid #eee; }
            header nav ul li:last-child { border-bottom: none; }
            .menu-toggle { display: block; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--color-primary-blue); }
            header nav ul li a.admin-action-btn { display: block; width: auto; margin: 0 1rem; }
        }
        
        /* Loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--color-primary-red);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <!-- 1. Header (En-t√™te) -->
    <header role="banner">
        <div class="logo-container">
            <a href="index.html">
                <img src="logo1.jpeg" alt="Droit D√©cod√© Logo">
                <div class="logo-text"><strong>DROIT</strong> <span>D√âCOD√â</span></div>
            </a>
        </div>

        <nav role="navigation" aria-label="Menu principal du site">
            <ul id="main-navigation">
                <li><a href="index.html">Accueil</a></li>
                <li><a href="articles.html">Articles & Explications</a></li>
                <!-- ADMIN EDIT BUTTONS CONTAINER -->
                <li id="admin-actions-container" class="hidden flex gap-2">
                    <!-- Les boutons Sauvegarder/Annuler/√âditer seront ins√©r√©s ici par JS -->
                </li>
                <li><a href="tiktok.html">TikTok Publications</a></li>
                <li class="relative"><a href="about.html" class="active" aria-current="page">√Ä Propos</a></li>
                <li><a href="contact.html" class="contact-btn">Contact</a></li>
                <!-- Auth Link -->
                <li id="auth-link-container">
                    <a href="login.html" class="log-btn" id="auth-link">Se connecter</a>
                </li>
            </ul>
        </nav>

        <button class="menu-toggle" aria-expanded="false" aria-controls="main-navigation">
            &#9776;
            <span class="sr-only">Ouvrir le menu</span>
        </button>
    </header>

    <!-- 2. Main Content: √Ä Propos -->
    <main class="container">
        <!-- Main Title (Editable) -->
        <h1 id="main-title" class="text-4xl md:text-5xl font-extrabold mb-10 text-center text-primary-blue border-b-4 pb-3 border-primary-red editable-content">
            <!-- Content will be loaded from Firestore -->
            <div id="title-placeholder" class="spinner mx-auto"></div>
        </h1>

        <section class="bg-white p-8 rounded-xl shadow-2xl mb-12">

            <!-- Mission Text (Editable) -->
            <h2 class="text-3xl font-bold mb-6 text-primary-red">Notre Mission Fondatrice</h2>
            <p id="mission-text" class="text-xl mb-8 leading-relaxed border-l-4 border-primary-blue pl-4 italic text-gray-700 editable-content">
                 <!-- Content will be loaded from Firestore -->
            </p>

            <!-- Non-editable structural content for simplification -->
            <h2 class="text-2xl font-semibold text-primary-blue mt-10 mb-4 border-b pb-2">Pour Qui ?</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center mb-10">
                <div class="p-4 bg-primary-red text-white rounded-lg shadow-md">
                    <p class="text-3xl mb-2">üéì</p>
                    <p class="font-bold">√âtudiants en Droit</p>
                    <p class="text-sm">Pour ma√Ætriser les notions fondamentales et r√©ussir vos examens.</p>
                </div>
                <div class="p-4 bg-primary-blue text-white rounded-lg shadow-md">
                    <p class="text-3xl mb-2">üíº</p>
                    <p class="font-bold">Professionnels</p>
                    <p class="text-sm">Pour une veille juridique rapide et fiable, et rafra√Æchir la m√©moire.</p>
                </div>
                <div class="p-4 bg-primary-red text-white rounded-lg shadow-md">
                    <p class="text-3xl mb-2">üí°</p>
                    <p class="font-bold">Citoyens Curieux</p>
                    <p class="text-sm">Pour comprendre vos droits et obligations au quotidien.</p>
                </div>
            </div>

            <h2 class="text-2xl font-semibold text-primary-blue mt-10 mb-4 border-b pb-2">Notre Valeur Ajout√©e : Un Contenu Structur√©</h2>
            <ul class="list-none space-y-4 pl-0 text-gray-700">
                <!-- Content here is static for this version to focus on main text editing -->
                <li class="flex items-start p-4 bg-secondary-bg rounded-lg shadow-sm border-l-4 border-primary-red">
                    <span class="text-2xl mr-3">‚úçÔ∏è</span>
                    <div><span class="font-bold text-primary-blue">D√©cryptage de Fond (Articles & Synth√®ses)</span>
                    <p class="text-sm mt-1">Des analyses approfondies et des synth√®ses structur√©es sur les concepts cl√©s et les nouvelles l√©gislations, r√©dig√©es pour l'excellence acad√©mique et professionnelle.</p></div>
                </li>
                <li class="flex items-start p-4 bg-secondary-bg rounded-lg shadow-sm border-l-4 border-primary-blue">
                    <span class="text-2xl mr-3">‚öñÔ∏è</span>
                    <div><span class="font-bold text-primary-red">Jurisprudence en Clair (Commentaires d'Arr√™t)</span>
                    <p class="text-sm mt-1">Des fiches d'arr√™ts et des commentaires de d√©cisions judiciaires majeures, essentiels pour ma√Ætriser la pratique du droit et la m√©thode juridique.</p></div>
                </li>
                <li class="flex items-start p-4 bg-secondary-bg rounded-lg shadow-sm border-l-4 border-primary-red">
                    <span class="text-2xl mr-3">üé•</span>
                    <div><span class="font-bold text-primary-blue">Le Droit 2.0 (Contenu Multim√©dia)</span>
                    <p class="text-sm mt-1">Des capsules TikTok dynamiques pour un apprentissage rapide, visuel et parfaitement adapt√© aux r√©seaux sociaux.</p></div>
                </li>
            </ul>

            <!-- Engagement Text (Editable) -->
            <div class="mt-12 p-6 bg-primary-blue text-white rounded-xl shadow-2xl">
                <h3 class="text-2xl font-bold mb-3" id="engagement-title">Notre Engagement de Rigueur</h3>
                <p id="engagement-text" class="text-lg editable-content">
                    <!-- Content will be loaded from Firestore -->
                </p>
            </div>
        </section>

    </main>
    <!-- -------------------------------------------------------- -->

    <!-- 3. Footer -->
    <footer role="contentinfo">
        <div class="footer-content">
            <p>&copy; 2025 Droit D√©cod√©. Tous droits r√©serv√©s.</p>
            <div class="footer-links">
                <a href="about.html">√Ä Propos</a> | 
                <a href="contact.html">Contact</a> | 
                <a href="mentions.html">Mentions L√©gales</a>
            </div>
            <p>Email: droitdecode@gmail.com</p>
        </div>
    </footer>

    <!-- 4. Notification FAB & Modal (Omitted for brevity in this section, kept in script) -->
    <button id="notification-fab" aria-label="Notifications et annonces">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
        <span class="notification-dot" title="Nouvelles annonces"></span>
        <span id="notification-badge" data-count="2">2</span>
    </button>
    <div id="notification-panel" role="dialog" aria-modal="true" aria-labelledby="notification-title">
        <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
            <h3 id="notification-title" class="text-xl font-bold text-primary-blue">Annonces Droit D√©cod√©</h3>
            <button id="close-panel" aria-label="Fermer le panneau de notifications" class="text-gray-500 hover:text-gray-800">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div id="notification-list" class="p-2 space-y-2 overflow-y-auto max-h-[380px]"></div>
        <div id="no-notifications" class="text-center p-6 text-gray-500 hidden">
            Aucune nouvelle annonce pour le moment.
        </div>
    </div>

    <!-- 5. Scripts JS & Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- GLOBAL CONSTANTS ---
        const ADMIN_UID = "v4086Cxmi9PMI31GUBZzY8rHyIA3";
        const CONTENT_DOC_PATH = 'about/main_content'; // Simplified path within 'about_content' collection

        // --- FIREBASE SETUP ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth, userId;
        let isAuthReady = false;
        let isEditing = false;
        let originalContent = {}; // To store the content before editing for the Cancel function

        // Elements DOM for editing
        const mainTitleEl = document.getElementById('main-title');
        const missionTextEl = document.getElementById('mission-text');
        const engagementTextEl = document.getElementById('engagement-text');
        const editableElements = [mainTitleEl, missionTextEl, engagementTextEl];

        // Placeholder content structure if Firestore is empty
        const DEFAULT_CONTENT = {
            mainTitle: "Droit D√©cod√© : Transformer la Complexit√© en Clart√©",
            missionText: "Le droit est le fondement de notre soci√©t√©, mais son acc√®s et sa compr√©hension ne devraient pas √™tre un privil√®ge. Chez **Droit D√©cod√©**, nous avons une mission claire : **briser les barri√®res de la complexit√© juridique**. Nous sommes d√©termin√©s √† rendre le savoir juridique non seulement accessible, mais √©galement engageant et imm√©diatement applicable pour tous.",
            engagementText: "**L'Expertise est Notre Priorit√©.** Tous nos contenus sont √©labor√©s, relus et valid√©s par une √©quipe de **juristes qualifi√©s**, garantissant une rigueur irr√©prochable et une actualisation constante face aux √©volutions l√©gislatives. Droit D√©cod√© est la r√©f√©rence pour transformer la complexit√© en clart√©.",
        };

        // --- UTILITY FUNCTIONS ---
        function getDisplayName(user) {
            if (user.uid === ADMIN_UID) return "Admin";
            if (user.email) return user.email.split('@')[0];
            return "Utilisateur";
        }

        /**
         * Met √† jour le bouton de connexion/d√©connexion et initialise l'√©couteur de contenu.
         * @param {Object | null} user L'objet utilisateur Firebase.
         */
        function updateAuthUI(user) {
            const authLink = document.getElementById('auth-link');
            if (!authLink) return;

            if (user) {
                const userName = getDisplayName(user);
                authLink.textContent = `D√©connexion (${userName})`;
                authLink.href = '#'; 
                authLink.classList.remove('log-btn');
                authLink.classList.add('bg-primary-red', 'text-white', 'hover:bg-red-700', 'border-transparent'); 
                
                authLink.onclick = async (e) => {
                    e.preventDefault();
                    try {
                        await signOut(auth);
                        window.location.reload(); 
                    } catch (error) {
                        console.error("Erreur d√©connexion:", error.message);
                    }
                };
            } else {
                authLink.textContent = 'Se connecter';
                authLink.href = 'login.html'; // Supposons l'existence d'une page login.html
                authLink.classList.add('log-btn');
                authLink.classList.remove('bg-primary-red', 'text-white', 'hover:bg-red-700', 'border-transparent');
                authLink.onclick = null;
            }

            updateAdminUI(user);
        }

        /**
         * Active/D√©sactive le mode √©dition pour l'admin.
         * @param {boolean} enable Si true, active l'√©dition.
         */
        function toggleEditMode(enable) {
            isEditing = enable;
            
            editableElements.forEach(el => {
                el.contentEditable = enable ? "true" : "false";
                if (enable) {
                    el.classList.add('p-2', 'rounded-lg', 'editable-content');
                } else {
                    el.classList.remove('p-2', 'rounded-lg', 'editable-content');
                }
            });

            // Mettre √† jour les boutons d'action
            renderAdminActions(isEditing);
            
            // Si on sort du mode √©dition (via Cancel ou Save), assure la mise √† jour
            if (!enable) {
                // Si on sort par Cancel, on restaure le contenu
                if (mainTitleEl.textContent !== originalContent.mainTitle) {
                    mainTitleEl.innerHTML = originalContent.mainTitle;
                }
            } else {
                // Si on entre en mode √©dition, on sauvegarde l'√©tat original
                originalContent.mainTitle = mainTitleEl.innerHTML;
                originalContent.missionText = missionTextEl.innerHTML;
                originalContent.engagementText = engagementTextEl.innerHTML;
            }
        }

        /**
         * Rend les boutons d'action de l'administrateur (√âditer / Sauvegarder & Annuler).
         * @param {boolean} inEditMode Si l'utilisateur est en mode √©dition.
         */
        function renderAdminActions(inEditMode) {
            const container = document.getElementById('admin-actions-container');
            if (!container || !isAuthReady || userId !== ADMIN_UID) {
                container?.classList.add('hidden');
                return;
            }
            container.classList.remove('hidden');
            container.innerHTML = '';
            
            if (inEditMode) {
                // Boutons Sauvegarder et Annuler
                const saveBtn = document.createElement('button');
                saveBtn.id = 'save-btn';
                saveBtn.className = 'admin-action-btn save-btn';
            
                saveBtn.className = 'admin-action-btn save-btn';
                saveBtn.textContent = 'Sauvegarder';
                saveBtn.onclick = saveContent;
                container.appendChild(saveBtn);

                const cancelBtn = document.createElement('button');
                cancelBtn.id = 'cancel-btn';
                cancelBtn.className = 'admin-action-btn cancel-btn';
                cancelBtn.textContent = 'Annuler';
                cancelBtn.onclick = () => toggleEditMode(false);
                container.appendChild(cancelBtn);

            } else {
                // Bouton √âditer
                const editBtn = document.createElement('button');
                editBtn.id = 'edit-btn';
                editBtn.className = 'admin-action-btn edit-mode-btn';
                editBtn.textContent = '√âditer cette page';
                editBtn.onclick = () => toggleEditMode(true);
                container.appendChild(editBtn);
            }
        }
        
        /**
         * G√®re la visibilit√© et l'affichage des boutons Admin.
         * @param {Object | null} user L'objet utilisateur Firebase.
         */
        function updateAdminUI(user) {
            userId = user?.uid;
            renderAdminActions(isEditing);
        }

        /**
         * Sauvegarde le contenu des champs √©ditables vers Firestore.
         */
        async function saveContent() {
            if (!db || userId !== ADMIN_UID) {
                console.error("Non autoris√© ou base de donn√©es non initialis√©e.");
                return;
            }

            // Afficher le spinner de sauvegarde
            const saveBtn = document.getElementById('save-btn');
            saveBtn.innerHTML = '<div class="spinner mx-auto"></div>';
            saveBtn.disabled = true;

            const newContent = {
                mainTitle: mainTitleEl.innerHTML,
                missionText: missionTextEl.innerHTML,
                engagementText: engagementTextEl.innerHTML,
            };

            const docRef = doc(db, 'artifacts', appId, 'public', 'data', CONTENT_DOC_PATH);
            try {
                // Utiliser setDoc avec { merge: true } pour ne pas √©craser d'autres champs potentiels
                await setDoc(docRef, newContent, { merge: true });
                console.log("Contenu sauvegard√© avec succ√®s!");
                
                // D√©sactiver le mode √©dition et restaurer le bouton
                toggleEditMode(false); 

            } catch (e) {
                console.error("Erreur lors de la sauvegarde du document: ", e);
                alert("Erreur de sauvegarde: Consultez la console.");
            } finally {
                saveBtn.innerHTML = 'Sauvegarder'; // Restaure le texte apr√®s succ√®s ou √©chec
                saveBtn.disabled = false;
            }
        }

        /**
         * √âcoute en temps r√©el les changements de contenu dans Firestore.
         */
        function listenToContent() {
            if (!db) return;
            const docRef = doc(db, 'artifacts', appId, 'public', 'data', CONTENT_DOC_PATH);

            onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    console.log("Nouveau contenu charg√© depuis Firestore.");
                    mainTitleEl.innerHTML = data.mainTitle || DEFAULT_CONTENT.mainTitle;
                    missionTextEl.innerHTML = data.missionText || DEFAULT_CONTENT.missionText;
                    engagementTextEl.innerHTML = data.engagementText || DEFAULT_CONTENT.engagementText;
                } else {
                    console.log("Document de contenu non trouv√©. Initialisation avec le contenu par d√©faut.");
                    // Utiliser le contenu par d√©faut et tenter de le sauvegarder pour initialisation
                    mainTitleEl.innerHTML = DEFAULT_CONTENT.mainTitle;
                    missionTextEl.innerHTML = DEFAULT_CONTENT.missionText;
                    engagementTextEl.innerHTML = DEFAULT_CONTENT.engagementText;
                    setDoc(docRef, DEFAULT_CONTENT).catch(e => console.error("Erreur d'initialisation du doc:", e));
                }
            }, (error) => {
                console.error("Erreur d'√©coute Firestore:", error);
                mainTitleEl.innerHTML = `Erreur: ${error.code}`;
            });

            // Retirer le placeholder de chargement
            document.getElementById('title-placeholder')?.remove();
        }

        // --- FIREBASE INITIALIZATION ---
        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // Authentification
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                // Mise en place de l'√©couteur d'√©tat d'auth et de contenu
                onAuthStateChanged(auth, user => {
                    isAuthReady = true;
                    updateAuthUI(user);
                    listenToContent(); 
                });

            } catch (error) {
                console.error("Erreur FATALE lors de l'initialisation Firebase:", error);
            }
        }

        document.addEventListener('DOMContentLoaded', initializeFirebase);
        
        // --- JAVASCRIPT POUR LA CLOCHE DE NOTIFICATION (Tel que fourni) ---
        const NOTIFICATIONS_DATA = [
            { id: 1, title: "üö® Nouvelle Section : Mentions L√©gales", content: "La page 'Mentions L√©gales' est maintenant en ligne ! Consultez-la via le pied de page pour plus de transparence.", date: "Aujourd'hui", link: "mentions.html", read: false },
            { id: 2, title: "üìö Mise √† jour des Articles Cl√©s", content: "Tous les articles de 'Droit Civil' ont √©t√© revus et mis √† jour avec les derni√®res r√©formes l√©gislatives. Bonne lecture !", date: "Hier", link: "articles.html", read: false },
            { id: 3, title: "üéâ Lancement du Site Officiel", content: "Bienvenue sur le site officiel de Droit D√©cod√© ! Plus de contenu, plus de clart√©. N'h√©sitez pas √† nous contacter.", date: "Il y a 3 jours", link: "contact.html", read: true }
        ];

        const fab = document.getElementById('notification-fab');
        const panel = document.getElementById('notification-panel');
        const badge = document.getElementById('notification-badge');
        const dot = document.querySelector('#notification-fab .notification-dot');
        const closeBtn = document.getElementById('close-panel');
        const list = document.getElementById('notification-list');
        const noNotifications = document.getElementById('no-notifications');

        function renderNotifications() {
            list.innerHTML = ''; 
            if (NOTIFICATIONS_DATA.length === 0) {
                noNotifications.classList.remove('hidden');
                badge.style.display = 'none';
                dot.style.display = 'none';
                fab.setAttribute('data-unread', 0);
                return;
            } else { noNotifications.classList.add('hidden'); }

            let unreadCount = 0;
            NOTIFICATIONS_DATA.forEach(notif => {
                if (!notif.read) { unreadCount++; }

                const item = document.createElement('a');
                item.href = notif.link || '#';
                item.className = `block p-3 rounded-lg transition duration-200 ${notif.read ? 'bg-white hover:bg-gray-100 border-l-2 border-transparent' : 'bg-secondary-bg hover:bg-gray-200 border-l-2 border-primary-red'}`;
                item.innerHTML = `
                    <p class="text-sm font-semibold ${notif.read ? 'text-gray-800' : 'text-primary-blue'}">${notif.title}</p>
                    <p class="text-xs text-gray-500 mt-1">${notif.content}</p>
                    <p class="text-xs text-gray-400 mt-1">${notif.date}</p>
                `;
                list.appendChild(item);
            });

            badge.textContent = unreadCount;
            fab.setAttribute('data-unread', unreadCount);

            if (unreadCount > 0) { dot.style.display = 'block'; badge.style.display = 'block'; } 
            else { dot.style.display = 'none'; badge.style.display = 'none'; dot.style.animation = 'none'; }
        }

        fab.addEventListener('click', (e) => {
            e.preventDefault();
            const isPanelOpen = panel.classList.contains('open');
            if (!isPanelOpen) {
                panel.classList.add('open');
                let unreadExists = false;
                NOTIFICATIONS_DATA.forEach(notif => {
                    if (!notif.read) { notif.read = true; unreadExists = true; }
                });
                if (unreadExists) { renderNotifications(); }
            } else {
                panel.classList.remove('open');
            }
        });

        closeBtn.addEventListener('click', () => { panel.classList.remove('open'); });
        document.addEventListener('click', (event) => {
            if (panel.classList.contains('open') && !panel.contains(event.target) && !fab.contains(event.target)) {
                panel.classList.remove('open');
            }
        });

        document.addEventListener('DOMContentLoaded', renderNotifications);

        // Gestion de l'interrupteur du menu mobile
        const menuToggle = document.querySelector('.menu-toggle');
        const mainNavigation = document.getElementById('main-navigation');

        menuToggle.addEventListener('click', () => {
            const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true' || false;
            menuToggle.setAttribute('aria-expanded', !isExpanded);
            mainNavigation.classList.toggle('open');
        });
    </script>
</body>
</html>