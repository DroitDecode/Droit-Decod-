<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Droit Décodé - À Propos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

    <style>
        :root {
            --color-primary-red: #E84D3D;
            --color-primary-blue: #3E4B7A;
            --color-secondary-bg: #F8F9FA;
        }
        body { background-color: var(--color-secondary-bg); font-family: 'Inter', sans-serif; min-height: 100vh; display: flex; flex-direction: column; }
        main { flex-grow: 1; }
        .text-primary-red { color: var(--color-primary-red); }
        .bg-primary-red { background-color: var(--color-primary-red); }
        .text-primary-blue { color: var(--color-primary-blue); }
        
        /* Style quand on édite */
        .editable-active {
            outline: 3px dashed var(--color-primary-red);
            background-color: #fffdec;
            padding: 5px;
            border-radius: 8px;
        }

        header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; background-color: white; shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .nav-links { display: flex; gap: 1.5rem; align-items: center; list-style: none; }
    </style>
</head>
<body>

    <header>
        <div class="flex items-center">
            <img src="logo1.jpeg" alt="Logo" class="h-10 w-10 rounded-full mr-2">
            <div class="text-xl font-bold tracking-tight">
                <span class="text-primary-blue">DROIT</span> <span class="text-primary-red">DÉCODÉ</span>
            </div>
        </div>
        <nav>
            <ul class="nav-links font-semibold text-gray-600">
                <li><a href="index.html">Accueil</a></li>
                <li><a href="articles.html">Articles</a></li>
                <li><a href="about.html" class="text-primary-red">À Propos</a></li>
                <li id="admin-controls" class="hidden flex gap-2">
                    </li>
            </ul>
        </nav>
    </header>

    <main class="max-w-4xl mx-auto p-6 mt-10">
        <h1 id="field-title" class="text-4xl md:text-5xl font-black text-center text-primary-blue mb-10 border-b-4 border-primary-red pb-4">
            Chargement...
        </h1>

        <div class="bg-white p-8 rounded-2xl shadow-xl">
            <h2 class="text-2xl font-bold text-primary-red mb-4 uppercase tracking-wide">Notre Mission</h2>
            <div id="field-mission" class="text-xl leading-relaxed text-gray-700 italic border-l-4 border-primary-blue pl-6 mb-10">
                Chargement de la mission...
            </div>

            <div class="bg-primary-blue p-6 rounded-xl text-white shadow-lg">
                <h3 class="text-xl font-bold mb-2">Notre Engagement</h3>
                <div id="field-engagement" class="text-lg opacity-90">
                    Chargement de l'engagement...
                </div>
            </div>
        </div>
    </main>

    <footer class="p-10 text-center text-gray-400 text-sm">
        <p>&copy; 2025 Droit Décodé. Tous droits réservés.</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDpNtHXiZK3bIyLwAUlTNAiWRrg2vhPYeE",
            authDomain: "droitdecode-9aa4d.firebaseapp.com",
            projectId: "droitdecode-9aa4d",
            storageBucket: "droitdecode-9aa4d.firebasestorage.app",
            messagingSenderId: "219930978240",
            appId: "1:219930978240:web:886c40e47d276c75548a25"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const ADMIN_UID = "v4086Cxmi9PMI31GUBZzY8rHyIA3";
        const DOC_REF = doc(db, "Settings", "AboutPage");

        const elTitle = document.getElementById('field-title');
        const elMission = document.getElementById('field-mission');
        const elEngagement = document.getElementById('field-engagement');
        const adminControls = document.getElementById('admin-controls');

        let isEditing = false;

        // 1. CHARGER LES DONNÉES EN TEMPS RÉEL
        onSnapshot(DOC_REF, (snap) => {
            if (snap.exists()) {
                const data = snap.data();
                if (!isEditing) {
                    elTitle.innerText = data.title || "Titre par défaut";
                    elMission.innerText = data.mission || "Mission par défaut";
                    elEngagement.innerText = data.engagement || "Engagement par défaut";
                }
            }
        });

        // 2. VÉRIFIER SI C'EST L'ADMIN
        onAuthStateChanged(auth, (user) => {
            if (user && user.uid === ADMIN_UID) {
                showAdminButtons();
            }
        });

        function showAdminButtons() {
            adminControls.classList.remove('hidden');
            renderButtons();
        }

        function renderButtons() {
            adminControls.innerHTML = '';
            const btn = document.createElement('button');
            btn.className = "px-4 py-2 rounded-lg font-bold text-white transition " + (isEditing ? "bg-green-500" : "bg-blue-600");
            btn.innerText = isEditing ? "✅ SAUVEGARDER" : "✏️ MODIFIER LA PAGE";
            
            btn.onclick = async () => {
                if (!isEditing) {
                    startEditing();
                } else {
                    await saveChanges();
                }
            };
            adminControls.appendChild(btn);

            if (isEditing) {
                const cancelBtn = document.createElement('button');
                cancelBtn.className = "px-4 py-2 bg-gray-400 text-white rounded-lg font-bold";
                cancelBtn.innerText = "Annuler";
                cancelBtn.onclick = () => location.reload();
                adminControls.appendChild(cancelBtn);
            }
        }

        function startEditing() {
            isEditing = true;
            [elTitle, elMission, elEngagement].forEach(el => {
                el.contentEditable = true;
                el.classList.add('editable-active');
            });
            renderButtons();
        }

        async function saveChanges() {
            try {
                await updateDoc(DOC_REF, {
                    title: elTitle.innerText,
                    mission: elMission.innerText,
                    engagement: elEngagement.innerText
                });
                isEditing = false;
                [elTitle, elMission, elEngagement].forEach(el => {
                    el.contentEditable = false;
                    el.classList.remove('editable-active');
                });
                renderButtons();
                alert("Modifications enregistrées !");
            } catch (e) {
                console.error(e);
                alert("Erreur de sauvegarde.");
            }
        }
    </script>
</body>
</html>
